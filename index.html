<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Solar Space Dodge</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #050510;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            touch-action: none; /* Prevent default touch actions like scrolling */
        }
        canvas {
            display: block;
        }
        #ui-layer {
            position: absolute;
            top: 20px;
            left: 20px;
            pointer-events: none;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
        }
        h1 {
            margin: 0;
            font-size: 24px;
            color: #4ade80;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        p {
            margin: 5px 0 0 0;
            font-size: 14px;
            opacity: 0.8;
        }
        #fuel-container {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.4);
        }
        #fuel-bar {
            height: 100%;
            width: 100%;
            background: linear-gradient(90deg, #ff4d4d, #f9cb28, #4ade80);
            transform-origin: left;
            transition: transform 0.1s linear;
        }
        #fuel-label {
            position: absolute;
            bottom: 55px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            font-weight: bold;
            color: #f9cb28;
            text-shadow: 0 1px 2px black;
        }
        #game-over {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.85);
            padding: 40px;
            border-radius: 16px;
            text-align: center;
            border: 1px solid #444;
            backdrop-filter: blur(5px);
            z-index: 10;
        }
        button {
            background: #4ade80;
            color: #050510;
            border: none;
            padding: 12px 24px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 20px;
            transition: background 0.2s;
        }
        button:hover {
            background: #22c55e;
        }
        #controls-hint {
            position: absolute;
            bottom: 10px;
            width: 100%;
            text-align: center;
            font-size: 12px;
            color: rgba(255,255,255,0.4);
            pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="ui-layer">
        <h1>Sector 7</h1>
        <p>Score: <span id="score">0</span></p>
    </div>

    <div id="fuel-label">SOLAR PANELS ACTIVE</div>
    <div id="fuel-container">
        <div id="fuel-bar"></div>
    </div>

    <div id="controls-hint">Use Arrow Keys or Touch Sides to Move</div>

    <div id="game-over">
        <h2 style="margin-top: 0; color: #ff4d4d; font-size: 32px;">CRITICAL FAILURE</h2>
        <p style="font-size: 18px;">Final Score: <span id="final-score">0</span></p>
        <button onclick="resetGame()">RELAUNCH</button>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const fuelBar = document.getElementById('fuel-bar');
    const fuelLabel = document.getElementById('fuel-label');
    const gameOverScreen = document.getElementById('game-over');
    const finalScoreEl = document.getElementById('final-score');

    // Game State
    let gameActive = true;
    let score = 0;
    let frames = 0;
    let difficultyMultiplier = 1;

    // Viewport management
    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // Input Handling
    const keys = {
        ArrowUp: false,
        ArrowDown: false,
        ArrowLeft: false,
        ArrowRight: false
    };

    window.addEventListener('keydown', (e) => {
        if(keys.hasOwnProperty(e.code)) keys[e.code] = true;
    });

    window.addEventListener('keyup', (e) => {
        if(keys.hasOwnProperty(e.code)) keys[e.code] = false;
    });

    // Touch Handling
    let touchX = null;
    let touchY = null;
    window.addEventListener('touchstart', (e) => {
        touchX = e.touches[0].clientX;
        touchY = e.touches[0].clientY;
    });
    window.addEventListener('touchmove', (e) => {
        e.preventDefault(); // prevent scrolling
        touchX = e.touches[0].clientX;
        touchY = e.touches[0].clientY;
    }, { passive: false });
    window.addEventListener('touchend', () => {
        touchX = null;
        touchY = null;
    });

    // Game Objects
    const ship = {
        x: canvas.width / 2,
        y: canvas.height - 100,
        width: 60,  // Made wider
        height: 50, // Squatter ratio
        speed: 7,
        color: '#3b82f6',
        fuel: 100,
        maxFuel: 100,
        fuelRegenRate: 0.08, // Passive solar regen
        fuelConsumption: 0.4 // Cost to move
    };

    let comets = [];
    let stars = [];
    let particles = [];

    // Initialize Stars
    for(let i=0; i<100; i++) {
        stars.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            size: Math.random() * 2,
            speed: Math.random() * 3 + 0.5
        });
    }

    class Particle {
        constructor(x, y, color, speed) {
            this.x = x;
            this.y = y;
            this.color = color;
            this.size = Math.random() * 4 + 2;
            this.speedX = (Math.random() - 0.5) * speed;
            this.speedY = (Math.random() - 0.5) * speed;
            this.life = 1.0;
        }
        update() {
            this.x += this.speedX;
            this.y += this.speedY;
            this.life -= 0.02;
        }
        draw() {
            ctx.fillStyle = this.color;
            ctx.globalAlpha = this.life;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fill();
            ctx.globalAlpha = 1.0;
        }
    }

    class Comet {
        constructor() {
            this.radius = Math.random() * 25 + 15; // Bigger rocks
            this.x = Math.random() * (canvas.width - this.radius * 2) + this.radius;
            this.y = -50;
            this.speed = Math.random() * 3 + 3 + (difficultyMultiplier * 0.5);
            this.color = '#94a3b8';
            this.rotation = Math.random() * Math.PI * 2;
            this.rotationSpeed = (Math.random() - 0.5) * 0.1;
            
            // Irregular shape points
            this.points = [];
            const segments = 8;
            for(let i=0; i<segments; i++) {
                const angle = (i / segments) * Math.PI * 2;
                const r = this.radius * (0.7 + Math.random() * 0.6); // Jaggedness
                this.points.push({
                    x: Math.cos(angle) * r,
                    y: Math.sin(angle) * r
                });
            }
        }

        update() {
            this.y += this.speed;
            this.rotation += this.rotationSpeed;
        }

        draw() {
            ctx.save();
            ctx.translate(this.x, this.y);
            ctx.rotate(this.rotation);
            ctx.fillStyle = this.color;
            ctx.strokeStyle = '#64748b';
            ctx.lineWidth = 2;
            
            ctx.beginPath();
            if(this.points.length > 0) {
                ctx.moveTo(this.points[0].x, this.points[0].y);
                for(let i=1; i<this.points.length; i++) {
                    ctx.lineTo(this.points[i].x, this.points[i].y);
                }
            }
            ctx.closePath();
            ctx.fill();
            ctx.stroke();

            // Add some crater details
            ctx.fillStyle = 'rgba(0,0,0,0.2)';
            ctx.beginPath();
            ctx.arc(5, 5, this.radius * 0.3, 0, Math.PI * 2);
            ctx.fill();

            ctx.restore();
        }
    }

    function createExplosion(x, y, color) {
        for(let i=0; i<15; i++) {
            particles.push(new Particle(x, y, color, 10));
        }
    }

    function drawShip() {
        ctx.save();
        ctx.translate(ship.x, ship.y);
        
        // Engine Trail
        if (gameActive) {
            const flicker = Math.random() * 10;
            ctx.fillStyle = `rgba(249, 203, 40, ${0.5 + Math.random() * 0.5})`;
            ctx.beginPath();
            ctx.moveTo(-15, 20);
            ctx.lineTo(0, 40 + flicker + (ship.fuel < 10 ? 0 : 10)); // Trail shrinks if low fuel
            ctx.lineTo(15, 20);
            ctx.fill();
        }

        // Main Body - WIDER design
        ctx.fillStyle = ship.color;
        // Main fuselage
        ctx.beginPath();
        ctx.moveTo(0, -25); // Nose
        ctx.lineTo(25, 20); // Right Wing back
        ctx.lineTo(10, 25); // Right engine mount
        ctx.lineTo(0, 20);  // Rear center
        ctx.lineTo(-10, 25);// Left engine mount
        ctx.lineTo(-25, 20);// Left Wing back
        ctx.closePath();
        ctx.fill();

        // Cockpit
        ctx.fillStyle = '#bae6fd';
        ctx.beginPath();
        ctx.ellipse(0, -5, 8, 12, 0, 0, Math.PI * 2);
        ctx.fill();

        // Solar Panel Details (Wings)
        ctx.fillStyle = '#1e3a8a'; // Dark blue panels
        ctx.beginPath();
        ctx.moveTo(12, 0);
        ctx.lineTo(22, 18);
        ctx.lineTo(14, 18);
        ctx.lineTo(8, 5);
        ctx.fill();
        
        ctx.beginPath();
        ctx.moveTo(-12, 0);
        ctx.lineTo(-22, 18);
        ctx.lineTo(-14, 18);
        ctx.lineTo(-8, 5);
        ctx.fill();

        ctx.restore();
    }

    function update() {
        if (!gameActive) return;

        // Difficulty scaling
        difficultyMultiplier = 1 + (score / 1000);

        // --- FUEL SYSTEM ---
        let isMoving = false;
        
        // Keyboard movement
        if (keys.ArrowUp && ship.y > ship.height/2) { ship.y -= ship.speed; isMoving = true; }
        if (keys.ArrowDown && ship.y < canvas.height - ship.height/2) { ship.y += ship.speed; isMoving = true; }
        if (keys.ArrowLeft && ship.x > ship.width/2) { ship.x -= ship.speed; isMoving = true; }
        if (keys.ArrowRight && ship.x < canvas.width - ship.width/2) { ship.x += ship.speed; isMoving = true; }

        // Touch movement (follow finger)
        if (touchX !== null && touchY !== null) {
            const dx = touchX - ship.x;
            const dy = touchY - ship.y;
            const dist = Math.sqrt(dx*dx + dy*dy);
            
            if (dist > 10) { // Deadzone
                const moveX = (dx / dist) * ship.speed;
                const moveY = (dy / dist) * ship.speed;
                
                // Boundary checks for touch
                if (ship.x + moveX > ship.width/2 && ship.x + moveX < canvas.width - ship.width/2) ship.x += moveX;
                if (ship.y + moveY > ship.height/2 && ship.y + moveY < canvas.height - ship.height/2) ship.y += moveY;
                
                isMoving = true;
            }
        }

        // Fuel Logic
        if (isMoving) {
            ship.fuel -= ship.fuelConsumption;
            fuelLabel.innerText = "CONSUMING FUEL";
            fuelLabel.style.color = "#ff4d4d";
        } else {
            // Solar Regeneration
            ship.fuel += ship.fuelRegenRate;
            fuelLabel.innerText = "SOLAR CHARGING...";
            fuelLabel.style.color = "#f9cb28";
        }

        // Clamp fuel
        if (ship.fuel < 0) {
            ship.fuel = 0;
            gameOver("Out of Fuel");
        }
        if (ship.fuel > ship.maxFuel) {
            ship.fuel = ship.maxFuel;
            if(!isMoving) {
                fuelLabel.innerText = "BATTERY FULL";
                fuelLabel.style.color = "#4ade80";
            }
        }
        
        // Update UI Bar
        const fuelPercent = (ship.fuel / ship.maxFuel) * 100;
        fuelBar.style.transform = `scaleX(${fuelPercent / 100})`;

        // --- STARFIELD ---
        stars.forEach(star => {
            star.y += star.speed + (isMoving ? 2 : 0); // Parallax effect
            if (star.y > canvas.height) {
                star.y = 0;
                star.x = Math.random() * canvas.width;
            }
        });

        // --- COMETS ---
        // Spawn Logic (Spawn rate increases with score)
        // Rate: at 0 score ~1% chance per frame. At 1000 score ~2% chance.
        const spawnThreshold = 0.02 + (score * 0.00001); 
        if (Math.random() < spawnThreshold) {
            comets.push(new Comet());
        }

        for (let i = comets.length - 1; i >= 0; i--) {
            let c = comets[i];
            c.update();

            // Collision Detection
            const dx = ship.x - c.x;
            const dy = ship.y - c.y;
            const distance = Math.sqrt(dx * dx + dy * dy);

            // Simple circle collision
            if (distance < c.radius + 20) { // 20 is approx ship radius
                createExplosion(ship.x, ship.y, '#f9cb28');
                createExplosion(c.x, c.y, '#94a3b8');
                gameOver("Ship Destroyed");
            }

            // Remove off-screen
            if (c.y > canvas.height + 50) {
                comets.splice(i, 1);
                score += 10;
                scoreEl.innerText = score;
            }
        }

        // --- PARTICLES ---
        for (let i = particles.length - 1; i >= 0; i--) {
            particles[i].update();
            if (particles[i].life <= 0) particles.splice(i, 1);
        }

        frames++;
    }

    function draw() {
        // Clear background
        ctx.fillStyle = '#050510';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Draw Stars
        ctx.fillStyle = 'white';
        stars.forEach(star => {
            ctx.beginPath();
            ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
            ctx.fill();
        });

        // Draw Comets
        comets.forEach(c => c.draw());

        // Draw Ship
        if (gameActive) drawShip();

        // Draw Particles
        particles.forEach(p => p.draw());

        requestAnimationFrame(loop);
    }

    function loop() {
        update();
        draw();
    }

    function gameOver(reason) {
        gameActive = false;
        gameOverScreen.style.display = 'block';
        finalScoreEl.innerText = score;
        document.querySelector('#game-over h2').innerText = reason.toUpperCase();
    }

    function resetGame() {
        score = 0;
        scoreEl.innerText = '0';
        ship.fuel = 100;
        ship.x = canvas.width / 2;
        ship.y = canvas.height - 100;
        comets = [];
        particles = [];
        gameActive = true;
        gameOverScreen.style.display = 'none';
    }

    // Start
    loop();

</script>
</body>
</html>